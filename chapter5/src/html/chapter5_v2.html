<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div class="wrap_converter">
    <h1>HTML 태그 변환기(Tag Converter)</h1>
    <div class="tag_converter">aaaa</div>
    <button type="button" class="btn_create">버튼생성</button>
  </div>
  <script>
    // 버튼 생성: 입력받은 태그명으로 변환 버튼을 동적으로 생성
    function createButton(){
      // 사용자에게 변환할 태그명을 입력받는다
      const tagArea = prompt('변경할 태그를 입력하세요.(예: div, section, button, ...)');
      // 허용 가능한 HTML 태그 목록 (기본 검증용)
      const elementList = [
        'a',
        'abbr',
        'address',
        'area',
        'article',
        'aside',
        'audio',
        'b',
        'base',
        'bdi',
        'bdo',
        'blockquote',
        'body',
        'br',
        'button',
        'canvas',
        'caption',
        'cite',
        'code',
        'col',
        'colgroup',
        'data',
        'datalist',
        'dd',
        'del',
        'details',
        'dfn',
        'dialog',
        'div',
        'dl',
        'dt',
        'em',
        'embed',
        'fieldset',
        'figcaption',
        'figure',
        'footer',
        'form',
        'h1',
        'h2',
        'h3',
        'h4',
        'h5',
        'h6',
        'head',
        'header',
        'hgroup',
        'hr',
        'html',
        'i',
        'iframe',
        'img',
        'input',
        'ins',
        'kbd',
        'label',
        'legend',
        'li',
        'link',
        'main',
        'map',
        'mark',
        'menu',
        'meta',
        'meter',
        'nav',
        'noscript',
        'object',
        'ol',
        'optgroup',
        'option',
        'output',
        'p',
        'param',
        'picture',
        'pre',
        'progress',
        'q',
        'rp',
        'rt',
        'ruby',
        's',
        'samp',
        'script',
        'search',
        'section',
        'select',
        'small',
        'source',
        'span',
        'strong',
        'style',
        'sub',
        'summary',
        'sup',
        'svg',
        'table',
        'tbody',
        'td',
        'template',
        'textarea',
        'tfoot',
        'th',
        'thead',
        'time',
        'title',
        'tr',
        'track',
        'u',
        'ul',
        'var',
        'video',
        'wbr',
      ];
      const wrapConverter = document.querySelector('.wrap_converter');
      // 변환을 실행할 버튼 노드
      const btnConverter = document.createElement('button');
      
      // 기존에 만들어둔 변환 버튼이 있으면 삭제 (중복 방지)
      if(document.querySelector('.btn_converter') != null){
        wrapConverter.removeChild(document.querySelector('.btn_converter'));
      }

      // 입력한 태그가 허용 목록에 있을 때만 버튼 생성
      if(elementList.includes(tagArea)){
        btnConverter.textContent = tagArea;
        wrapConverter.appendChild(btnConverter).setAttribute('type', 'button');
        btnConverter.setAttribute('class', 'btn_converter');
        // 클릭 시 실제 변환 수행
        btnConverter.onclick = function(){
          converter(tagArea);
        };
        
        // 동적생성된 버튼에서는 이벤트 위임을 사용해야함, 아래와 같은 방식은 동적생성된 버튼에 적용되 않음
        // converter(tagArea);
      }else{
        alert(`${tagArea} 태그는 존재하지 않습니다`);
      }
    }

    // 속성 파서: "key=value, key2=value2" 문자열을 객체로 변환
    function parseAttributes(input){
      // 빈 입력이면 빈 객체 반환
      if(!input || !input.trim()) return {};
      return input
        .split(',')
        .map(pair => pair.trim())
        .filter(Boolean)
        .reduce((acc, pair) => {
          const eqIndex = pair.indexOf('=');
          if(eqIndex === -1){
            // 단일 토글 속성 지원 (예: disabled)
            acc[pair] = true;
            return acc;
          }
          // key=value 형태 분리
          const key = pair.slice(0, eqIndex).trim();
          const value = pair.slice(eqIndex + 1).trim();
          acc[key] = value;
          return acc;
        }, {});
    }

    // 범용 속성 적용기: 파싱된 속성들을 요소에 일괄 반영
    function applyAttributes(element, attrs){
      if(!attrs) return;

      // 불리언 속성 목록 (존재 유무로 의미가 결정되는 속성들)
      const booleanAttributes = new Set([
        'disabled','checked','readonly','required','autofocus','multiple','hidden'
      ]);

      Object.keys(attrs).forEach((rawKey) => {
        const value = attrs[rawKey];
        const key = rawKey;

        // 텍스트 내용 처리: text=내용
        if(key === 'text'){
          element.textContent = value;
          return;
        }

        // class 처리: 공백만 구분자 사용 (class만 지원)
        if(key === 'class'){
          const classes = String(value)
            .split(/\s+/)
            .map(v => v.trim())
            .filter(Boolean);
          if(classes.length){
            element.classList.add(...classes);
          }
          return;
        }

        // style 처리: 세미콜론(;)만 구분자 사용, 각 항목은 key:value
        if(key === 'style'){
          const stylePairs = String(value)
            .split(/[;]+/)
            .map(v => v.trim())
            .filter(Boolean);
          stylePairs.forEach(p => {
            const i = p.indexOf(':');
            if(i === -1) return;
            const sk = p.slice(0, i).trim();
            const sv = p.slice(i + 1).trim();
            element.style[sk] = sv;
          });
          return;
        }

        // data-* 처리: data-role=btn 같이 임의 데이터 속성
        if(key.startsWith('data-')){
          element.setAttribute(key, value);
          return;
        }

        // boolean 속성 처리: true/빈값이면 속성 존재로 설정, 아니면 제거
        if(booleanAttributes.has(key)){
          if(value === true || String(value).toLowerCase() === 'true' || value === ''){
            element.setAttribute(key, '');
          }else{
            element.removeAttribute(key);
          }
          return;
        }

        // 일반 속성 처리 (id, placeholder, href, src, type, value 등)
        element.setAttribute(key, value);
      });
    }

    // 실제 변환 로직: 현재 .tag_converter 요소를 새 태그로 교체
    function converter(tagArea){      
      const currentTag = document.querySelector('.tag_converter');
      const updatedTag = document.createElement(tagArea);

      // 선택 입력: 사용자 정의 속성 (비워도 됨)
      const input = prompt('적용할 속성을 입력하세요. 예) id=foo, class=bar baz, placeholder=이름, data-role=btn\n(비우면 속성 적용 없이 변환됩니다)');
      const attrs = parseAttributes(input);

      // 기존 텍스트 유지: 사용자가 text를 명시하지 않은 경우에만
      const userSpecifiedContent = attrs.hasOwnProperty('text');
      if(!userSpecifiedContent && tagArea !== 'img' && tagArea !== 'input'){
        updatedTag.textContent = currentTag.textContent;
      }

      // 범용 속성 적용
      applyAttributes(updatedTag, attrs);

      // 변환기 클래스는 유지 (식별용)
      updatedTag.classList.add('tag_converter');

      currentTag.replaceWith(updatedTag);
    }

    // 이벤트 연결: 초기 버튼 클릭 이벤트를 묶는다
    function bindEvents(){
      const btnCreate = document.querySelector('.btn_create');
      btnCreate.addEventListener('click', createButton);
    }

    // 초기화: 페이지 로드시 한 번만 실행
    function init(){
      bindEvents();
    }

    init();
  </script>
</body>
</html>