<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div class="wrap_random">
    <div class="box_random"></div>
    <div>
      <label for="ipLength">난수 길이</label>
      <input type="number" class="ip_length" id="ipLength">
    </div>
    <div class="box_btn">
      <button type="button" class="btn_random" style="display:block;width:217px">난수 생성</button>
    </div>
  </div>
  <script>
    const App = {
      // 난수 코드 배열로 저장 - 초기화 시 한 번만 생성
      codeArr: [],

      // 빈값 체크
      isEmpty: function(element){
        if (!element.value.trim()) {
          alert('값이 비어있습니다');
          App.resetData(element);
          return false;
        } else {
          return true;
        }
      },

      // 데이터 초기화
      resetData: function(element){
        element.focus();
        element.value = '';
      },

      // 난수 알파벳 대문자 배열 생성
      getRandomString: function(){
        let charCodeArr = [];

        for(let i = 0; i <= 90 - 65; i++){
          charCodeArr[i] = String.fromCharCode(65 + i);
        }

        const alphabetArr = charCodeArr.sort(() => Math.random() - 0.5);

        return alphabetArr;
      },

      // 난수 숫자배열 생성
      getRandomInt: function(count){
        let numArr = [];
        let randomNum;
        
        while (count > numArr.length){
          randomNum = Math.floor(Math.random() * 10);
          if(!numArr.includes(randomNum)){
            numArr.push(randomNum);
          }
        }

        return numArr;
      },

      // random 코드 생성
      getRandomCode: function(count){
        const ipLength = document.querySelector('.ip_length');
        const numArr = this.getRandomInt(10);
        const alphabetArr = this.getRandomString();

        let code = '';

        if(Number(count) < 4){
          alert('최소 4이상의 숫자를 입력해주세요');
          this.resetData(ipLength);
          return;
        }
        if(Number(count) >= 10){
          alert('10미만의 숫자를 입력해주세요');
          this.resetData(ipLength);
          return;
        }

        const randomArr = [
          ...numArr,
          ...alphabetArr
        ].sort(() => Math.random() - 0.5);

        for(let i = 0; i < Number(count); i++){
          code += randomArr[i];
        }

        return this.getCodeDuplicate(code);
      },

      // code 배열 (중복 체크)
      getCodeDuplicate: function(code){
        if(!this.codeArr.includes(code)){
          this.codeArr.push(code);
        }else{
          alert('중복된 코드입니다. 다시 생성해주세요.');
          return;
        }
        
        return this.codeArr;
      },

      // 난수 요소 출력
      randomCreate: function(codeLength){
        const boxRandom = document.querySelector('.box_random');
        const printCodeArr = this.getRandomCode(codeLength);
        
        boxRandom.textContent = printCodeArr;
      },

      // 요소 생성
      createElements: function(config) {
        const element = document.createElement(config.tag);
        element.classList.add(config.className);
        if (config.textCont) {
          element.textContent = config.textCont;
        }
        if (config.attr) {
          for (let key in config.attr) {
            element.setAttribute(key, config.attr[key]);
          }
        }
        return element;
      },

      // 이벤트 연결
      bindEvents: function(){
        const boxRandom = document.querySelector('.box_random');
        const boxBtn = document.querySelector('.box_btn');
        const ipLength = document.querySelector('.ip_length');
        const btnRandom = document.querySelector('.btn_random');
        const btnChange = this.createElements({ 'tag': 'button', 'className': 'btn_change', 'attr': {'type': 'button', 'style': 'display:block;width:217px'}, textCont: '소문자 변환' });

        btnRandom.addEventListener('click', () => {
          if(!this.isEmpty(ipLength)) return;
          
          this.randomCreate(ipLength.value);
          boxBtn.appendChild(btnChange);
        });

        boxBtn.addEventListener('click', (e) => {
          if(e.target.classList.contains('btn_change')){
            boxRandom.textContent = boxRandom.textContent.toLowerCase();
          }
        });
      },

      // 로드시 초기 세팅
      init: function(){
        this.bindEvents();
      }
    };

    App.init();
  </script>
</body>
</html>